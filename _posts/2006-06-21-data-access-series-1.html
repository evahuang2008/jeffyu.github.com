--- 
layout: post
title: Data Access Series ( 1 )
published: true
meta: 
  spaces_a43755b404d273dfcedbd14ccb4f51ab_permalink: http://cid-04001c604af3f011.users.api.live.net/Users(288261576051650577)/Blogs('4001C604AF3F011!102')/Entries('4001C604AF3F011!401')?authkey=X13wC75MXT0%24
  _searchme: "1"
tags: 
- Java
type: post
status: publish
---
<div id="msgcns!4001C604AF3F011!401" class="bvMsg"><div>  现在做为一个Java程序员,已经渐渐的比较少和具体的数据库SQL打交道,因为我们经常都是用ORM工具(Hibernate..etc)或者其他的已经对底层封装了的包.</div>
<div>  我个人一直也在数据库这一块知识了解的比较差,所以我就贴些这方面的东西,今天的资料是来自(<a href="http://www.theserverside.com/tt/talks/videos/JohnGoodson/interview.tss?bandwidth=dsl">http://www.theserverside.com/tt/talks/videos/JohnGoodson/interview.tss?bandwidth=dsl</a>) </div>
<ol>
<li>是否都用PreparedStatements来替代Statements呢?<br />其实不是的,PreparedStatements是带有cache的功能,但是执行一个PreparedStatements是执行了两次的round trip,但是statements只有一次的round trip.但是preparedsStatements带有缓存的作用.</li>
<li>为什么说获取到一个Connection耗时很多呢?<br />获取到一个connection慢,是因为它不但要执行网络连接操作而且还要执行硬盘I/O操作. 获取到一个connection,要有9次的round trip, 比如说获取到数据库的options, transcation-mode, changing locales等等....</li>
<li>怎么样提高SQL语句执行的效率呢?<br />其中有一点就是,把你要选择的列写出来,不要用*号替代,这个对于执行速度的提高是很有帮助的.</li></ol>
<p>---------Reference-----------------------------------------------------------------------------------------------------------</p>
<p><b><font color="#339966"> </font><a title="click to load the video clip for this question" style="text-decoration:none;" href="http://www.theserverside.com/talks/videos/JohnGoodson/dsl/q25.html"><font color="#0000ff"><font color="#339966">A lot of the best practice books always tell you to use PreparedStatements as they can be cached. Is there a tradeoff there?</font> </font></a></b></p>
<p><font color="#ff0000">There is a trade off there, . And, in fact, one of our recommendations is to not always use PreparedStatements. We have a white paper on our website: www.datadirect.com, which specifically covers a whole lot of performance tuning aspects of JDBCspecifically for the PreparedStatement case. If you're only going to execute a statement one time then there's no reason to prepare, because a prepared execute results in two network round trips. Two biggest things you can do in a JDBC application to improve performance: cut down in network I/O, cut down your disk I/O. Those are the two, by far slowest things. If you take nothing else away from this whole discussion, remember those two things. </font></p>
<p><font color="#ff0000">In terms of PreparedStatements, if I prepare a query, that's a network round trip to the database. If I then execute it, that's another network round trip to the database. If I know my application is only ever going to execute that query one time, I should execute the statement directly, avoid the overhead of the prepare, which again is that network round trip; you'll get a better performance out of that. If I am going to execute it again at some point in time in the life of the application than you would want to use PreparedStatement caching. But again, don't just do it blindly, understand that if the query is going to be executed only once, don't prepare it. Just execute it. </font></p>
<p><b><a title="click to load the video clip for this question" style="text-decoration:none;" href="http://www.theserverside.com/talks/videos/JohnGoodson/dsl/q26.html"><font color="#108301">Why is connecting to the database so expensive? </font></a></b></p>
<p><font color="#ff0000">That's a great question. Everybody's heard about connection pooling, I should use connection pooling, but really a lot of people don't understand why. It's said that one of the most expensive things you can do in a database application is to hit the network. If I have a network I/O it's going to slow me down. Additionally, if I have to have a disk I/O, that's going to slow me down as well. Connecting is the worst thing you can do because it's both disk I/O's and networking I/Os. </font></p>
<p><font color="#ff0000">A lot of people assume that if I just connect to Oracle, what can that be? One network round trip to the server. In fact, at a JDBC driver level, of course the application never sees this, but when you connect, or when you ask for a connection to be made, a JDBC driver makes 9 network round trips, to and from the Oracle database. Setting up the code page, figuring out what specific options have been set on the database, turning auto-commit into the mode that it needs to be part of the specification, changing locales, need be. </font></p>
<p><font color="#ff0000">There's just lots of interaction that has to occur between that handshake between the driver and the server. What connection pooling allows you, is it cuts off all of the network I/O, which speeds up performance of you app. </font></p>
<p><b><a title="click to load the video clip for this question" style="text-decoration:none;" href="http://www.theserverside.com/talks/videos/JohnGoodson/dsl/q27.html"><font color="#108301">If a developer could do one thing to improve performance, what would that be? </font></a></b></p>
<p><font color="#ff0000">That's a good question. Developers do a lot of wrong things. Again, there are lots of hints out there to help developers write better apps but think about what a driver has to do. Probably the biggest thing that we see that we can improve performance, is that developers code SQL statements and instead of saying: select name, address, city, zip code, they say select * from table. And then they go out and they get only the name columns, only the address column, the city, the zip. And they think: Well I didn't ask for the picture of the employee, so, therefore, I'm not going to be hurt by that. </font></p>
<p><font color="#ff0000">What, in fact happens with a driver though, is a driver has no idea what you're going to ask for. So if you issue a select * from table, what a driver does is it sends that to the server, and then it brings every bit of that information across the network. So, if there happens to be a picture of an employee stored, it's going to bring the entire contents of the picture over to wherever you JDBC application is whether or not you've asked for it. And we've already stated that you want to cut down on network I/O. Select * from table only increases network I/O. </font></p>
<p><font color="#ff0000">So the biggest thing we would recommend is if you know you're only going to need four columns in a table, put those four columns in the select list and don't limit it at get at a time.</font></p>
<p><font color="#ff0000"></font> </p></div>
